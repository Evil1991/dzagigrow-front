'use strict';


/// сладер на главной с товарами
document.addEventListener("DOMContentLoaded",()=> {
	const SLIDER_NAME = 'slider-index';
	const SLIDER_CLASS = '.' + SLIDER_NAME;

	if (document.querySelector(SLIDER_CLASS) !== null) {
		const SLIDER_SETTINGS = {
			init: true,
			loop: true,
			loopedSlides: 0,
			grabCursor: true,
			// autoplay: {
			// 	delay: 5000,
			// 	pauseOnMouseEnter: true
			// },
			navigation: {
				nextEl: '.js-' + SLIDER_NAME + '-next',
				prevEl: '.js-' + SLIDER_NAME + '-prev',
				disabledClass: SLIDER_NAME + '__navigation-item_disabled'
			},
			pagination: {
				bulletClass: SLIDER_NAME +'__pagination-item',
				bulletActiveClass: SLIDER_NAME +'__pagination-item_active',
				clickable: true,
				clickableClass:  SLIDER_NAME +'__pagination-item_clickable',
				el: '.' + SLIDER_NAME +'__pagination'
			},
			preloadImages: false,
			slidesPerView: 1,
			spaceBetween: 16,
			freeMode: false,
			containerModifierClass: SLIDER_NAME +'_',
			wrapperClass: SLIDER_NAME + '__wrapper',
			slideClass: SLIDER_NAME + '__item',
			slideActiveClass: SLIDER_NAME + '__item_active',
			slideDuplicateActiveClass: SLIDER_NAME + '__item_duplicate_active',
			slideVisibleClass: SLIDER_NAME + '__item_visible',
			slideDuplicateClass: SLIDER_NAME + '__item_duplicate',
			breakpoints: {}
		};
		window.swiper(SLIDER_CLASS, SLIDER_SETTINGS);
	}
});
window.slider = window.swiper = function(sliderSelector, sliderSettings) {
	if (document.querySelector(sliderSelector) !== null) {
		let slider = new Swiper(sliderSelector, sliderSettings);
		return slider;
	}
};
window.swiperThumbs = function(sliderSelector, sliderSettings) {
	if (document.querySelector(sliderSelector) !== null) {
		let slider = new Swiper(sliderSelector, sliderSettings);
		return slider;
	}
};


/// слайдер с отзывами
document.addEventListener("DOMContentLoaded",()=> {
    const SLIDER_NAME = 'testimonials';
    const SLIDER_CLASS = '.' + SLIDER_NAME;

    if (document.querySelector(SLIDER_CLASS) !== null) {
        const SLIDER_SETTINGS = {
            init: true,
            loop: true,
            loopedSlides: 0,
            grabCursor: true,
            // autoplay: {
            // 	delay: 5000,
            // 	pauseOnMouseEnter: true
            // },
            navigation: {
                nextEl: '.js-' + SLIDER_NAME + '-next',
                prevEl: '.js-' + SLIDER_NAME + '-prev',
                disabledClass: SLIDER_NAME + '__navigation-item_disabled'
            },
            pagination: {
                bulletClass: SLIDER_NAME +'__pagination-item',
                bulletActiveClass: SLIDER_NAME +'__pagination-item_active',
                clickable: true,
                clickableClass:  SLIDER_NAME +'__pagination-item_clickable',
                el: '.' + SLIDER_NAME +'__pagination'
            },
            preloadImages: false,
            slidesPerView: 1,
            spaceBetween: 24,
            freeMode: false,
            containerModifierClass: SLIDER_NAME +'_',
            wrapperClass: SLIDER_NAME + '__wrapper',
            slideClass: SLIDER_NAME + '__item',
            slideActiveClass: SLIDER_NAME + '__item_active',
            slideDuplicateActiveClass: SLIDER_NAME + '__item_duplicate_active',
            slideVisibleClass: SLIDER_NAME + '__item_visible',
            slideDuplicateClass: SLIDER_NAME + '__item_duplicate',
            breakpoints: {}
        };
        window.swiper(SLIDER_CLASS, SLIDER_SETTINGS);
    }
});

/// слайдер "c этим товаром покупают"
document.addEventListener("DOMContentLoaded",()=> {
    const SLIDER_NAME = 'also-buy-slider';
    const SLIDER_CLASS = '.' + SLIDER_NAME;

    if (document.querySelector(SLIDER_CLASS) !== null) {
        const SLIDER_SETTINGS = {
            init: true,
            loop: true,
            loopedSlides: 0,
            grabCursor: true,
            // autoplay: {
            // 	delay: 5000,
            // 	pauseOnMouseEnter: true
            // },
            navigation: {
                nextEl: '.js-' + SLIDER_NAME + '-next',
                prevEl: '.js-' + SLIDER_NAME + '-prev',
                disabledClass: SLIDER_NAME + '__navigation-item_disabled'
            },
            pagination: {
                bulletClass: SLIDER_NAME +'__pagination-item',
                bulletActiveClass: SLIDER_NAME +'__pagination-item_active',
                clickable: true,
                clickableClass:  SLIDER_NAME +'__pagination-item_clickable',
                el: '.' + SLIDER_NAME +'__pagination'
            },
            preloadImages: false,
            slidesPerView: 4,
            spaceBetween: 24,
            freeMode: false,
            containerModifierClass: SLIDER_NAME +'_',
            wrapperClass: SLIDER_NAME + '__wrapper',
            slideClass: SLIDER_NAME + '__item',
            slideActiveClass: SLIDER_NAME + '__item_active',
            slideDuplicateActiveClass: SLIDER_NAME + '__item_duplicate_active',
            slideVisibleClass: SLIDER_NAME + '__item_visible',
            slideDuplicateClass: SLIDER_NAME + '__item_duplicate',
            breakpoints: {}
        };
        window.swiper(SLIDER_CLASS, SLIDER_SETTINGS);
    }
});


$(document).ready(function() {

    $('.header__catalog-btn').on('click', function() {
        $(this).toggleClass('header__catalog-btn--active')
        $('body').toggleClass('catalog--active')
    })

    $('.header__sign-in').click(function(){
        $.fancybox.open({
            src: '.sign-in-modal',
            type: 'inline'
        });
    });

    $('.header__sign-up').click(function(){
        $.fancybox.open({
            src: '.sign-up-modal',
            type: 'inline'
        });
    });


    /**
     * Кнопки плюс минус
     */

    // Убавляем кол-во по клику
    $('.quantity_inner .bt_minus').click(function () {
        let $input = $(this).parent().find('.quantity');
        let count = parseInt($input.val()) - 1;
        count = count < 1 ? 1 : count;
        $input.val(count);
    });
    // Прибавляем кол-во по клику
    $('.quantity_inner .bt_plus').click(function () {
        let $input = $(this).parent().find('.quantity');
        let count = parseInt($input.val()) + 1;
        count = count > parseInt($input.data('max-count')) ? parseInt($input.data('max-count')) : count;
        $input.val(parseInt(count));
    });
    // Убираем все лишнее и невозможное при изменении поля
    $('.quantity_inner .quantity').bind("change keyup input click", function () {
        if (this.value.match(/[^0-9]/g)) {
            this.value = this.value.replace(/[^0-9]/g, '');
        }
        if (this.value == "") {
            this.value = 1;
        }
        if (this.value > parseInt($(this).data('max-count'))) {
            this.value = parseInt($(this).data('max-count'));
        }
    });

    /**
     * Фильтры
     */
    $('.catalog__filter-header').on('click', function () {
        let parent = $(this).closest('.catalog__filter-item');
        $(parent).toggleClass('catalog__filter-item--active');
    })
})

/**
 * Range slider
 */
window.onload = function(){
    slideOne();
    slideTwo();
}

let sliderOne = document.getElementById("slider-1");
let sliderTwo = document.getElementById("slider-2");
let displayValOne = document.getElementById("range1");
let displayValTwo = document.getElementById("range2");
let minGap = 0;
let sliderTrack = document.querySelector(".slider-track");
let sliderMaxValue = document.getElementById("slider-1").max;

function slideOne(){
    if(parseInt(sliderTwo.value) - parseInt(sliderOne.value) <= minGap){
        sliderOne.value = parseInt(sliderTwo.value) - minGap;
    }
    displayValOne.value = sliderOne.value;
    fillColor();
}
function slideTwo(){
    if(parseInt(sliderTwo.value) - parseInt(sliderOne.value) <= minGap){
        sliderTwo.value = parseInt(sliderOne.value) + minGap;
    }
    displayValTwo.value = sliderTwo.value;
    fillColor();
}
function fillColor(){
    let percent1 = (sliderOne.value / sliderMaxValue) * 100;
    let percent2 = (sliderTwo.value / sliderMaxValue) * 100;
    sliderTrack.style.background = `linear-gradient(to right, #dadae5 ${percent1}% , #00aa2e ${percent1}% , #00aa2e ${percent2}%, #dadae5 ${percent2}%)`;
}

displayValOne.addEventListener('input', function() {
    sliderOne.value = this.value;
    fillColor()
})
displayValTwo.addEventListener('input', function() {
    sliderTwo.value = this.value;
    fillColor()
})

